(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[856],{9093:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/lock",function(){return n(605)}])},605:function(e,t,n){"use strict";n.r(t),n.d(t,{__toc:function(){return d}});var r=n(5250),a=n(3010),i=n(2630),s=n(9251);n(1541);var l=n(895);let d=[{depth:2,value:"锁是什么",id:"锁是什么"},{depth:3,value:"锁的含义",id:"锁的含义"},{depth:3,value:"排他锁和共享锁",id:"排他锁和共享锁"},{depth:3,value:"公平锁和非公平锁",id:"公平锁和非公平锁"},{depth:2,value:"pthread 是什么",id:"pthread-是什么"},{depth:2,value:"AQS 是什么",id:"aqs-是什么"}];function _createMdxContent(e){let t=Object.assign({h1:"h1",h2:"h2",p:"p",strong:"strong",h3:"h3",blockquote:"blockquote"},(0,l.a)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{children:"关于锁 (Lock)"}),"\n",(0,r.jsx)(t.h2,{id:"锁是什么",children:"锁是什么"}),"\n",(0,r.jsxs)(t.p,{children:["想象一下，你正在参加一个大型派对，派对上有一间只能容纳一个人使用的洗手间。当有人在使用洗手间时，其他人必须等待他出来。这就是",(0,r.jsx)(t.strong,{children:"锁"}),"的基本概念。在编程世界中，",(0,r.jsx)(t.strong,{children:"锁"}),"就像那个",(0,r.jsx)(t.strong,{children:"洗手间的门"}),"，而",(0,r.jsx)(t.strong,{children:"线程"}),"就像",(0,r.jsx)(t.strong,{children:"派对的参与者"}),"。"]}),"\n",(0,r.jsx)(t.h3,{id:"锁的含义",children:"锁的含义"}),"\n",(0,r.jsxs)(t.p,{children:["在我们的派对例子中，如果没有",(0,r.jsx)(t.strong,{children:"锁"}),"（也就是洗手间的门），那么可能会出现尴尬的情况，比如两个人同时走进洗手间。在编程世界中，这种情况可能导致数据的不一致性和其他一些难以预料的问题。"]}),"\n",(0,r.jsx)(t.h3,{id:"排他锁和共享锁",children:"排他锁和共享锁"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["锁可以分",(0,r.jsx)(t.strong,{children:"排他锁"}),"（也称为互斥锁）和",(0,r.jsx)(t.strong,{children:"共享锁"}),"。"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["现在，让我们把派对的规模扩大一些，假设有一间大洗手间，可以容纳多个人同时使用。但是，如果有人需要使用洗手间来更换衣服，那么他们就需要确保洗手间里没有其他人。这就是",(0,r.jsx)(t.strong,{children:"排他锁"}),"和",(0,r.jsx)(t.strong,{children:"共享锁"}),"的概念。"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"排他锁"}),"就像是一个人需要更换衣服，他需要确保洗手间里没有其他人。在这种情况下，只有一个线程（派对的参与者）可以访问资源（洗手间）。"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"共享锁"}),"则像是多个人可以同时使用洗手间，在这种情况下，多个线程可以同时访问资源。但是如果有线程需要写入（更换衣服），那么它必须先获取",(0,r.jsx)(t.strong,{children:"排他锁"}),"。"]}),"\n",(0,r.jsx)(t.h3,{id:"公平锁和非公平锁",children:"公平锁和非公平锁"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"公平锁"}),"就像是洗手间的排队规则，每个人都必须按照到达的顺序等待使用洗手间。也就是说，如果你后来，你就需要到队伍的最后面去，找个凳子坐下，耐心等待。这就像一个线程在请求锁时，如果锁已经被其他线程占用，那么这个线程就会进入一个等待队列，等待前面的线程释放锁。这种方式是公平的，因为它保证了每个线程都会按照请求锁的顺序获取到锁。"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"非公平锁"}),"则不同，它就像是一个新来的人，他刚好看到有人刚从洗手间出来，他就可以直接进入洗手间，不用排队等待。在锁的世界中，当一个线程请求锁时，如果锁已经被其他线程占用，这个线程不会马上进入等待队列，而是会尝试直接获取锁。如果获取失败，它才会进入等待队列。"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"非公平锁"}),"虽然可能看起来不那么公正，但是由于它减少了线程切换和调度的开销，所以性能上会比",(0,r.jsx)(t.strong,{children:"公平锁"}),"更好。"]}),"\n",(0,r.jsx)(t.h2,{id:"pthread-是什么",children:"pthread 是什么"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"TODO"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"aqs-是什么",children:"AQS 是什么"}),"\n",(0,r.jsx)(t.p,{children:"AQS (Abstract Queued Synchronizer) 是 Java 标准库中的一个管程工具。"}),"\n",(0,r.jsx)(t.p,{children:"AQS 就像是派对洗手间的管理员，他负责管理洗手间的使用，确保每个人都能按照自己的需要使用洗手间。因此，如果洗手间当前无法满足你的使用 (如厕/更换衣服) 时，你只能先在外面坐着等着。"})]})}let o={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,l.a)(),e.components);return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/articles/lock.mdx",route:"/articles/lock",frontMatter:{title:"关于锁 (Lock)",date:"2023-06-30T00:00:00.000Z",tags:["multithreading","concurrency","locks","synchronization"],hidden:!1,draft:!1},timestamp:1768652696e3,pageMap:[{kind:"Meta",data:{profile:{type:"separator",title:"Profile"},index:"Home",tags:"Tags",archive:"Archive",articles:{type:"page",display:"hidden"}}},{kind:"MdxPage",name:"archive",route:"/archive",frontMatter:{title:"Archive"}},{kind:"Folder",name:"articles",route:"/articles",children:[{kind:"Meta",data:{"*":{display:"hidden"},lock:"关于锁 (Lock)",program_language:"Program Language",kernel:"Linux Kernel",i3wm:"i3wm",kafka:"Kafka",cache_coherence:"缓存一致性",memory_consistency_model:"内存一致性模型",passphraseless_ssh:"Docker SSH 免密登录"}},{kind:"MdxPage",name:"cache_coherence",route:"/articles/cache_coherence",frontMatter:{title:"缓存一致性",date:"2023-02-13T00:00:00.000Z",tags:["cpu","cache","coherence","memory"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"i3wm",route:"/articles/i3wm",frontMatter:{title:"i3wm",date:"2023-02-24T00:00:00.000Z",tags:["misc","linux","i3","window-manager"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"kafka",route:"/articles/kafka",frontMatter:{title:"Kafka",date:"2023-02-14T00:00:00.000Z",tags:["misc","kafka","messaging","streaming"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"kernel",route:"/articles/kernel",frontMatter:{title:"Linux Kernel",date:"2023-02-26T00:00:00.000Z",tags:["misc","kernel","os","linux"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"lock",route:"/articles/lock",frontMatter:{title:"关于锁 (Lock)",date:"2023-06-30T00:00:00.000Z",tags:["multithreading","concurrency","locks","synchronization"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"memory_consistency_model",route:"/articles/memory_consistency_model",frontMatter:{title:"内存一致性模型",date:"2023-02-13T00:00:00.000Z",tags:["cpu","memory","consistency","architecture"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"passphraseless_ssh",route:"/articles/passphraseless_ssh",frontMatter:{title:"Docker SSH 免密登录",date:"2023-02-12T00:00:00.000Z",tags:["docker","ssh","security","devops"],hidden:!1,draft:!1}},{kind:"MdxPage",name:"program_language",route:"/articles/program_language",frontMatter:{title:"Program Language",date:"2023-03-05T00:00:00.000Z",tags:["misc","programming-language","compilers","parsing"],hidden:!1,draft:!1}}]},{kind:"MdxPage",name:"index",route:"/",frontMatter:{title:"Home"}},{kind:"MdxPage",name:"tags",route:"/tags",frontMatter:{title:"Tags"}}],flexsearch:{codeblocks:!0},title:"关于锁 (Lock)",headings:d},pageNextRoute:"/articles/lock",nextraLayout:i.ZP,themeConfig:s.Z};t.default=(0,a.j)(o)},9251:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(5250);n(79);var a=n(6963),i=n.n(a),s=n(2630);let formatDateValue=e=>{if(!e)return null;if(e instanceof Date)return e.toISOString().slice(0,10);let t=e.trim();if(!t)return null;let n=new Date(t);return Number.isNaN(n.getTime())?t:n.toISOString().slice(0,10)},getDateMeta=e=>{let t=formatDateValue(null==e?void 0:e.updatedAt);if(t)return{label:"Updated on",value:t};let n=formatDateValue(null==e?void 0:e.createdAt);if(n)return{label:"Created on",value:n};let r=formatDateValue(null==e?void 0:e.date);return r?{label:"Published on",value:r}:null},normalizeTags=e=>Array.isArray(e)?e.map(e=>String(e).trim()).filter(Boolean):"string"==typeof e&&e.trim()?[e.trim()]:[];function ProfileSidebarHeader(){return(0,r.jsxs)("div",{className:"tw-flex tw-flex-col tw-gap-3 tw-px-1",children:[(0,r.jsx)("img",{src:"/avatar.jpg",alt:"Jover avatar",className:"tw-h-14 tw-w-14 tw-rounded-full tw-bg-neutral-200 tw-object-cover tw-ring-1 tw-ring-neutral-200 dark:tw-bg-neutral-800 dark:tw-ring-neutral-700"}),(0,r.jsxs)("div",{className:"tw-flex tw-flex-col tw-gap-1",children:[(0,r.jsx)("div",{className:"tw-text-base tw-font-semibold",children:"Jover"}),(0,r.jsx)("div",{className:"tw-text-xs tw-text-muted",children:"Rust/C++/编译器/操作系统/数据库"})]})]})}let l={logo:(0,r.jsx)("span",{children:"JoverZhang"}),project:{link:"https://github.com/JoverZhang"},navbar:{extraContent:(0,r.jsx)("nav",{style:{display:"flex",gap:"1rem",fontSize:"0.95rem"},children:(0,r.jsx)("a",{href:"/tags",style:{fontWeight:600},children:"Tags"})})},components:{h1:e=>{let{children:t,...n}=e,{frontMatter:a}=(0,s.ZR)(),l=getDateMeta(a),d=normalizeTags(null==a?void 0:a.tags),o=d.length>0&&!(null==a?void 0:a.hidden)&&!(null==a?void 0:a.draft),c=["tw-text-4xl","tw-font-semibold",n.className].filter(Boolean).join(" ");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{...n,className:c,children:t}),o?(0,r.jsx)("div",{className:"tw-mt-3 tw-flex tw-flex-wrap tw-gap-2",children:d.map(e=>(0,r.jsx)(i(),{href:"/articles?tag=".concat(encodeURIComponent(e)),className:"tw-rounded-full tw-border tw-border-gray-200 dark:tw-border-gray-700 tw-px-2.5 tw-py-0.5 tw-text-xs tw-text-muted",children:e},e))}):null,l?(0,r.jsxs)("p",{className:"tw-mt-2 tw-text-sm tw-text-muted",children:[l.label," ",l.value]}):null]})}},sidebar:{titleComponent:e=>{let{title:t,type:n}=e;return"separator"===n&&"Profile"===t?(0,r.jsx)(ProfileSidebarHeader,{}):(0,r.jsx)("span",{children:t})}},gitTimestamp:null,head:()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,r.jsx)("meta",{name:"description",content:"JoverZhang home"}),(0,r.jsx)("title",{children:"JoverZhang Home"})]}),footer:{text:(0,r.jsx)(function(){return(0,r.jsx)("footer",{style:{padding:"2rem 0",textAlign:"center",fontSize:"0.9rem"},children:(0,r.jsxs)("span",{children:["\xa9 ",new Date().getFullYear()," JoverZhang"]})})},{})}};var d=l},8625:function(){}},function(e){e.O(0,[335,467,774,888,179],function(){return e(e.s=9093)}),_N_E=e.O()}]);